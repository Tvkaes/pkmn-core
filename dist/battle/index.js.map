{"version":3,"sources":["../../src/battle/damage.ts","../../src/battle/engine-adapter.ts"],"names":["getStatValue"],"mappings":"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","file":"index.js","sourcesContent":["// Damage calculation utilities for battle simulation.\n// Implements the standard Pokemon damage formula.\n\nimport type { PokemonStat, PokemonMoveData } from '../pokemon/types'\n\nexport interface DamageContext {\n  level: number\n  attackerStats: PokemonStat[]\n  defenderStats: PokemonStat[]\n  attackerTypes: string[]\n  defenderTypes: string[]\n  move: PokemonMoveData\n  weather?: 'sun' | 'rain' | 'sand' | 'hail' | 'snow' | null\n  terrain?: 'electric' | 'grassy' | 'psychic' | 'misty' | null\n  isCritical?: boolean\n  isStab?: boolean\n  effectiveness?: number\n  otherModifiers?: number\n}\n\nexport interface DamageResult {\n  min: number\n  max: number\n  average: number\n  isCritical: boolean\n  effectiveness: number\n  isStab: boolean\n}\n\nfunction getStatValue(stats: PokemonStat[], name: string): number {\n  return stats.find((stat) => stat.stat.name === name)?.base_stat ?? 0\n}\n\nfunction calculateStatAtLevel(base: number, level: number, iv = 31, ev = 0, nature = 1): number {\n  return Math.floor(((2 * base + iv + Math.floor(ev / 4)) * level) / 100 + 5) * nature\n}\n\nfunction calculateHpAtLevel(base: number, level: number, iv = 31, ev = 0): number {\n  return Math.floor(((2 * base + iv + Math.floor(ev / 4)) * level) / 100 + level + 10)\n}\n\nexport function getTypeEffectiveness(\n  moveType: string,\n  defenderTypes: string[],\n  typeChart: Record<string, { strongAgainst: string[]; weakAgainst: string[]; immuneTo: string[] }>\n): number {\n  let multiplier = 1\n  const chart = typeChart[moveType.toLowerCase()]\n  if (!chart) return multiplier\n\n  for (const defType of defenderTypes) {\n    const normalizedDefType = defType.toLowerCase()\n    if (chart.strongAgainst.includes(normalizedDefType)) {\n      multiplier *= 2\n    } else if (chart.weakAgainst.includes(normalizedDefType)) {\n      multiplier *= 0.5\n    } else if (chart.immuneTo.includes(normalizedDefType)) {\n      multiplier = 0\n      break\n    }\n  }\n\n  return multiplier\n}\n\nexport function calculateBaseDamage(context: DamageContext): number {\n  const { level, attackerStats, defenderStats, move } = context\n  const isPhysical = move.damage_class?.name === 'physical'\n\n  const attackStat = isPhysical ? 'attack' : 'special-attack'\n  const defenseStat = isPhysical ? 'defense' : 'special-defense'\n\n  const attackBase = getStatValue(attackerStats, attackStat)\n  const defenseBase = getStatValue(defenderStats, defenseStat)\n\n  const attack = calculateStatAtLevel(attackBase, level)\n  const defense = calculateStatAtLevel(defenseBase, level)\n  const power = move.power ?? 0\n\n  if (power === 0 || defense === 0) return 0\n\n  // Standard damage formula: ((2 * Level / 5 + 2) * Power * A/D) / 50 + 2\n  const baseDamage = Math.floor(\n    (Math.floor((2 * level) / 5 + 2) * power * attack) / defense / 50 + 2\n  )\n\n  return baseDamage\n}\n\nexport function applyModifiers(\n  baseDamage: number,\n  context: DamageContext\n): { min: number; max: number } {\n  let damage = baseDamage\n\n  // STAB\n  const isStab =\n    context.isStab ??\n    context.attackerTypes.some(\n      (t) => t.toLowerCase() === context.move.type?.name?.toLowerCase()\n    )\n  if (isStab) {\n    damage = Math.floor(damage * 1.5)\n  }\n\n  // Type effectiveness\n  const effectiveness = context.effectiveness ?? 1\n  damage = Math.floor(damage * effectiveness)\n\n  // Weather modifiers\n  if (context.weather) {\n    const moveType = context.move.type?.name?.toLowerCase()\n    if (context.weather === 'sun' && moveType === 'fire') {\n      damage = Math.floor(damage * 1.5)\n    } else if (context.weather === 'sun' && moveType === 'water') {\n      damage = Math.floor(damage * 0.5)\n    } else if (context.weather === 'rain' && moveType === 'water') {\n      damage = Math.floor(damage * 1.5)\n    } else if (context.weather === 'rain' && moveType === 'fire') {\n      damage = Math.floor(damage * 0.5)\n    }\n  }\n\n  // Critical hit\n  const critMultiplier = context.isCritical ? 1.5 : 1\n  damage = Math.floor(damage * critMultiplier)\n\n  // Other modifiers\n  if (context.otherModifiers) {\n    damage = Math.floor(damage * context.otherModifiers)\n  }\n\n  // Random factor (85-100%)\n  const min = Math.floor(damage * 0.85)\n  const max = damage\n\n  return { min, max }\n}\n\nexport function calculateDamage(context: DamageContext): DamageResult {\n  const baseDamage = calculateBaseDamage(context)\n  const { min, max } = applyModifiers(baseDamage, context)\n\n  const isStab =\n    context.isStab ??\n    context.attackerTypes.some(\n      (t) => t.toLowerCase() === context.move.type?.name?.toLowerCase()\n    )\n\n  return {\n    min,\n    max,\n    average: Math.floor((min + max) / 2),\n    isCritical: context.isCritical ?? false,\n    effectiveness: context.effectiveness ?? 1,\n    isStab,\n  }\n}\n\nexport function calculateKOChance(\n  damage: DamageResult,\n  defenderHp: number\n): { ohko: number; twohko: number; threehko: number } {\n  if (defenderHp <= 0) {\n    return { ohko: 100, twohko: 100, threehko: 100 }\n  }\n\n  // Simplified KO chance calculation\n  const ohko = damage.min >= defenderHp ? 100 : damage.max >= defenderHp ? 50 : 0\n  const twohko = damage.min * 2 >= defenderHp ? 100 : damage.max * 2 >= defenderHp ? 75 : 0\n  const threehko = damage.min * 3 >= defenderHp ? 100 : damage.max * 3 >= defenderHp ? 85 : 0\n\n  return { ohko, twohko, threehko }\n}\n","// Engine adapter interface for battle simulation.\n// Provides abstraction layer for different battle engine implementations.\n\nimport type { PokemonData, PokemonMoveData } from '../pokemon/types'\nimport type { DamageResult } from './damage'\n\nexport type BattleWeather = 'sun' | 'rain' | 'sand' | 'hail' | 'snow' | null\nexport type BattleTerrain = 'electric' | 'grassy' | 'psychic' | 'misty' | null\n\nexport interface BattlePokemon {\n  id: string\n  species: string\n  level: number\n  types: string[]\n  stats: {\n    hp: number\n    attack: number\n    defense: number\n    specialAttack: number\n    specialDefense: number\n    speed: number\n  }\n  currentHp: number\n  status: string | null\n  ability: string\n  item: string | null\n  moves: string[]\n  boosts: {\n    attack: number\n    defense: number\n    specialAttack: number\n    specialDefense: number\n    speed: number\n    accuracy: number\n    evasion: number\n  }\n}\n\nexport interface BattleState {\n  turn: number\n  weather: BattleWeather\n  weatherTurns: number\n  terrain: BattleTerrain\n  terrainTurns: number\n  player1: {\n    active: BattlePokemon | null\n    team: BattlePokemon[]\n  }\n  player2: {\n    active: BattlePokemon | null\n    team: BattlePokemon[]\n  }\n}\n\nexport interface BattleAction {\n  type: 'move' | 'switch' | 'item'\n  player: 'player1' | 'player2'\n  moveIndex?: number\n  switchIndex?: number\n  itemId?: string\n}\n\nexport interface BattleEvent {\n  type: 'damage' | 'heal' | 'status' | 'boost' | 'weather' | 'terrain' | 'switch' | 'faint'\n  target: 'player1' | 'player2'\n  data: Record<string, unknown>\n}\n\nexport interface BattleEngineAdapter {\n  initialize(team1: PokemonData[], team2: PokemonData[]): BattleState\n  executeAction(state: BattleState, action: BattleAction): { state: BattleState; events: BattleEvent[] }\n  calculateDamage(attacker: BattlePokemon, defender: BattlePokemon, move: PokemonMoveData, state: BattleState): DamageResult\n  getValidActions(state: BattleState, player: 'player1' | 'player2'): BattleAction[]\n  isGameOver(state: BattleState): { over: boolean; winner: 'player1' | 'player2' | 'draw' | null }\n}\n\nexport function createBattlePokemon(data: PokemonData, level = 50): BattlePokemon {\n  const getStatValue = (name: string): number =>\n    data.stats.find((s) => s.stat.name === name)?.base_stat ?? 0\n\n  const calculateStat = (base: number, isHp = false): number => {\n    const iv = 31\n    const ev = 0\n    if (isHp) {\n      return Math.floor(((2 * base + iv + Math.floor(ev / 4)) * level) / 100 + level + 10)\n    }\n    return Math.floor(((2 * base + iv + Math.floor(ev / 4)) * level) / 100 + 5)\n  }\n\n  const hp = calculateStat(getStatValue('hp'), true)\n\n  return {\n    id: `${data.name}-${Date.now()}`,\n    species: data.name,\n    level,\n    types: data.types.map((t) => t.type.name),\n    stats: {\n      hp,\n      attack: calculateStat(getStatValue('attack')),\n      defense: calculateStat(getStatValue('defense')),\n      specialAttack: calculateStat(getStatValue('special-attack')),\n      specialDefense: calculateStat(getStatValue('special-defense')),\n      speed: calculateStat(getStatValue('speed')),\n    },\n    currentHp: hp,\n    status: null,\n    ability: data.abilities[0]?.ability?.name ?? '',\n    item: null,\n    moves: data.moves.slice(0, 4).map((m) => m.move.name),\n    boosts: {\n      attack: 0,\n      defense: 0,\n      specialAttack: 0,\n      specialDefense: 0,\n      speed: 0,\n      accuracy: 0,\n      evasion: 0,\n    },\n  }\n}\n\nexport function createInitialBattleState(team1: BattlePokemon[], team2: BattlePokemon[]): BattleState {\n  return {\n    turn: 0,\n    weather: null,\n    weatherTurns: 0,\n    terrain: null,\n    terrainTurns: 0,\n    player1: {\n      active: team1[0] ?? null,\n      team: team1,\n    },\n    player2: {\n      active: team2[0] ?? null,\n      team: team2,\n    },\n  }\n}\n\nexport function applyBoost(current: number, stages: number): number {\n  const multipliers = [2 / 8, 2 / 7, 2 / 6, 2 / 5, 2 / 4, 2 / 3, 2 / 2, 3 / 2, 4 / 2, 5 / 2, 6 / 2, 7 / 2, 8 / 2]\n  const index = Math.max(0, Math.min(12, stages + 6))\n  const multiplier = multipliers[index] ?? 1\n  return Math.floor(current * multiplier)\n}\n\nexport function clampBoost(boost: number): number {\n  return Math.max(-6, Math.min(6, boost))\n}\n"]}